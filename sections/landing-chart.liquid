{%- liquid
  assign text_blocks = section.blocks | where: "type", "text"

  assign circle_blocks = section.blocks | where: "type", "percent-circle"

  assign section_top = section.settings.section_top

  assign section_bottom = section.settings.section_bottom

  assign section_top_mobile = section.settings.section_top_mobile

  assign section_bottom_mobile = section.settings.section_bottom_mobile
-%}

<style>
  .landing-chart-data-grid {
    display: flex;
    justify-content: space-between;
    gap: var(--s2);
    max-width: 600px;
    margin-right: auto;
    margin-left: auto;
  }

  @media (min-width: 961px) {
    .landing-chart-data-grid {
      max-width: none;
      gap: var(--s3);
    }
  }

  .landing-chart-data-grid > * {
    flex: 1;
  }

  .landing-chart-circle {
    --progress: #B41214;
    --remaining: #FFFFFF;
    --thickness: 4;

    position: relative;
    display: grid;
    place-items: center;
    aspect-ratio: 1 / 1;
  }

  .landing-chart-ring {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .landing-chart-track,
  .landing-chart-progress {
    fill: none;
    stroke-width: var(--thickness);
  }

  .landing-chart-track {
    stroke: var(--remaining);
  }

  .landing-chart-progress {
    stroke: var(--progress);
    stroke-linecap: round;
  }
</style>

<div class="landing-container top-{{ section_top }} small--top-{{ section_top_mobile }} bottom-{{ section_bottom }} small--bottom-{{ section_bottom_mobile }}">
  <div class="landing-grid">
    <div>
      <div class="stack">
        {%- for block in text_blocks -%}
          {%- render "landing-text" block: block -%}
        {%- endfor -%}
      </div>
    </div>
    <div>
      <div class="landing-chart-data-grid">
        {%- for block in circle_blocks -%}
          {%- liquid
            assign percent = block.settings.percent

            assign radius = 52

            assign circumference = 326.7256

            assign offset = 100 | minus: percent | times: circumference | divided_by: 100

            assign description = block.settings.description
          -%}

          <div class="stack-2 small--stack-1">
            <div class="landing-chart-circle">
              <svg class="landing-chart-ring" viewBox="0 0 120 120" aria-hidden="true">
                <g transform="rotate(90 60 60)">
                  <circle class="landing-chart-track" cx="60" cy="60" r="{{ radius }}" />
                  <circle
                    class="landing-chart-progress"
                    cx="60"
                    cy="60"
                    r="{{ radius }}"
                    stroke-dasharray="{{ circumference }} {{ circumference }}"
                    stroke-dashoffset="{{ offset }}"
                  />
                </g>
              </svg>

              <span class="size-9 small--size-5">{{ percent }}%</span>
            </div>

            <p class="size-3">
              {{ description }}
            </p>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
</div>

{%- schema -%}
  {
    "name": "Chart",
    "tag": "section",
    "settings": [
      {
        "type": "select",
        "id": "section_top",
        "label": "Section top",
        "options": [
          {
            "label": "None",
            "value": "none"
          },
          {
            "label": "0",
            "value": "0"
          },
          {
            "label": "1",
            "value": "1"
          },
          {
            "label": "2",
            "value": "2"
          },
          {
            "label": "3",
            "value": "3"
          },
          {
            "label": "4",
            "value": "4"
          },
          {
            "label": "5",
            "value": "5"
          },
          {
            "label": "6",
            "value": "6"
          }
        ],
        "default": "none"
      },
      {
        "type": "select",
        "id": "section_bottom",
        "label": "Section bottom",
        "options": [
          {
            "label": "None",
            "value": "none"
          },
          {
            "label": "0",
            "value": "0"
          },
          {
            "label": "1",
            "value": "1"
          },
          {
            "label": "2",
            "value": "2"
          },
          {
            "label": "3",
            "value": "3"
          },
          {
            "label": "4",
            "value": "4"
          },
          {
            "label": "5",
            "value": "5"
          },
          {
            "label": "6",
            "value": "6"
          }
        ],
        "default": "none"
      },
      {
        "type": "select",
        "id": "section_top_mobile",
        "label": "Section top (mobile)",
        "options": [
          {
            "label": "None",
            "value": "none"
          },
          {
            "label": "0",
            "value": "0"
          },
          {
            "label": "1",
            "value": "1"
          },
          {
            "label": "2",
            "value": "2"
          },
          {
            "label": "3",
            "value": "3"
          },
          {
            "label": "4",
            "value": "4"
          },
          {
            "label": "5",
            "value": "5"
          }
        ],
        "default": "2"
      },
      {
        "type": "select",
        "id": "section_bottom_mobile",
        "label": "Section bottom (mobile)",
        "options": [
          {
            "label": "None",
            "value": "none"
          },
          {
            "label": "0",
            "value": "0"
          },
          {
            "label": "1",
            "value": "1"
          },
          {
            "label": "2",
            "value": "2"
          },
          {
            "label": "3",
            "value": "3"
          },
          {
            "label": "4",
            "value": "4"
          },
          {
            "label": "5",
            "value": "5"
          }
        ],
        "default": "none"
      }
    ],
    "blocks": [
      {
        "name": "Text",
        "type": "text",
        "settings": [
          {
            "type": "richtext",
            "id": "text",
            "label": "Text"
          },
          {
            "type": "header",
            "content": "Style"
          },
          {
            "type": "color",
            "id": "color",
            "label": "Color"
          },
          {
            "type": "range",
            "id": "size",
            "label": "Size",
            "min": -1,
            "max": 12,
            "step": 1,
            "default": 0
          },
          {
            "type": "range",
            "id": "size_mobile",
            "label": "Size (mobile)",
            "min": -1,
            "max": 12,
            "step": 1,
            "default": 0
          },
          {
            "type": "number",
            "id": "width",
            "label": "Width",
            "default": 610
          },
          {
            "type": "range",
            "id": "space",
            "label": "Space",
            "min": -3,
            "max": 5,
            "step": 1,
            "default": 1
          },
          {
            "type": "range",
            "id": "space_mobile",
            "label": "Space (mobile)",
            "min": -3,
            "max": 5,
            "step": 1,
            "default": 1
          }
        ]
      },
      {
        "name": "Percent circle",
        "type": "percent-circle",
        "limit": 3,
        "settings": [
          {
            "type": "range",
            "id": "percent",
            "label": "Percent",
            "min": 0,
            "max": 100,
            "step": 1,
            "default": 79,
            "unit": "%"
          },
          {
            "type": "textarea",
            "id": "description",
            "label": "Description"
          }
        ]
      }
    ]
  }
{%- endschema -%}
